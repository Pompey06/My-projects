function email_test(input) {
  return !/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,8})+$/.test(input.value);
}
var ua = window.navigator.userAgent;
var msie = ua.indexOf("MSIE ");
var isMobile = {
  Android: function () {
    return navigator.userAgent.match(/Android/i);
  },
  BlackBerry: function () {
    return navigator.userAgent.match(/BlackBerry/i);
  },
  iOS: function () {
    return navigator.userAgent.match(/iPhone|iPad|iPod/i);
  },
  Opera: function () {
    return navigator.userAgent.match(/Opera Mini/i);
  },
  Windows: function () {
    return navigator.userAgent.match(/IEMobile/i);
  },
  any: function () {
    return isMobile.Android() || isMobile.BlackBerry() || isMobile.iOS() || isMobile.Opera() || isMobile.Windows();
  },
};
function isIE() {
  ua = navigator.userAgent;
  var is_ie = ua.indexOf("MSIE ") > -1 || ua.indexOf("Trident/") > -1;
  return is_ie;
}
if (isIE()) {
  document.querySelector("html").classList.add("ie");
}
if (isMobile.any()) {
  document.querySelector("html").classList.add("_touch");
}

// Получить цифры из строки
//parseInt(itemContactpagePhone.replace(/[^\d]/g, ''))

function testWebP(callback) {
  var webP = new Image();
  webP.onload = webP.onerror = function () {
    callback(webP.height == 2);
  };
  webP.src =
    "data:image/webp;base64,UklGRjoAAABXRUJQVlA4IC4AAACyAgCdASoCAAIALmk0mk0iIiIiIgBoSygABc6WWgAA/veff/0PP8bA//LwYAAA";
}
testWebP(function (support) {
  if (support === true) {
    document.querySelector("html").classList.add("_webp");
  } else {
    document.querySelector("html").classList.add("_no-webp");
  }
});

function ibg() {
  if (isIE()) {
    let ibg = document.querySelectorAll("._ibg");
    for (var i = 0; i < ibg.length; i++) {
      if (ibg[i].querySelector("img") && ibg[i].querySelector("img").getAttribute("src") != null) {
        ibg[i].style.backgroundImage = "url(" + ibg[i].querySelector("img").getAttribute("src") + ")";
      }
    }
  }
}
ibg();

window.addEventListener("load", function () {
  if (document.querySelector(".wrapper")) {
    setTimeout(function () {
      document.querySelector(".wrapper").classList.add("_loaded");
    }, 0);
  }
});

let unlock = true;

//=================
//ActionsOnHash
if (location.hash) {
  const hsh = location.hash.replace("#", "");
  if (document.querySelector(".popup_" + hsh)) {
    popup_open(hsh);
  } else if (document.querySelector("div." + hsh)) {
    _goto(document.querySelector("." + hsh), 500, "");
  }
}
//=================
//Menu
let iconMenu = document.querySelector(".icon-menu");
if (iconMenu != null) {
  let delay = 500;
  let menuBody = document.querySelector(".menu__body");
  iconMenu.addEventListener("click", function (e) {
    if (unlock) {
      body_lock(delay);
      iconMenu.classList.toggle("_active");
      menuBody.classList.toggle("_active");
    }
  });
}
function menu_close() {
  let iconMenu = document.querySelector(".icon-menu");
  let menuBody = document.querySelector(".menu__body");
  iconMenu.classList.remove("_active");
  menuBody.classList.remove("_active");
}
//=================
//BodyLock
function body_lock(delay) {
  let body = document.querySelector("body");
  if (body.classList.contains("_lock")) {
    body_lock_remove(delay);
  } else {
    body_lock_add(delay);
  }
}
function body_lock_remove(delay) {
  let body = document.querySelector("body");
  if (unlock) {
    let lock_padding = document.querySelectorAll("._lp");
    setTimeout(() => {
      for (let index = 0; index < lock_padding.length; index++) {
        const el = lock_padding[index];
        el.style.paddingRight = "0px";
      }
      body.style.paddingRight = "0px";
      body.classList.remove("_lock");
    }, delay);

    unlock = false;
    setTimeout(function () {
      unlock = true;
    }, delay);
  }
}
function body_lock_add(delay) {
  let body = document.querySelector("body");
  if (unlock) {
    let lock_padding = document.querySelectorAll("._lp");
    for (let index = 0; index < lock_padding.length; index++) {
      const el = lock_padding[index];
      el.style.paddingRight = window.innerWidth - document.querySelector(".wrapper").offsetWidth + "px";
    }
    body.style.paddingRight = window.innerWidth - document.querySelector(".wrapper").offsetWidth + "px";
    body.classList.add("_lock");

    unlock = false;
    setTimeout(function () {
      unlock = true;
    }, delay);
  }
}
//=================
// LettersAnimation
let title = document.querySelectorAll("._letter-animation");
if (title) {
  for (let index = 0; index < title.length; index++) {
    let el = title[index];
    let txt = el.innerHTML;
    let txt_words = txt.replace("  ", " ").split(" ");
    let new_title = "";
    for (let index = 0; index < txt_words.length; index++) {
      let txt_word = txt_words[index];
      let len = txt_word.length;
      new_title = new_title + "<p>";
      for (let index = 0; index < len; index++) {
        let it = txt_word.substr(index, 1);
        if (it == " ") {
          it = "&nbsp;";
        }
        new_title = new_title + "<span>" + it + "</span>";
      }
      el.innerHTML = new_title;
      new_title = new_title + "&nbsp;</p>";
    }
  }
}
//=================
//Tabs
let tabs = document.querySelectorAll("._tabs");
for (let index = 0; index < tabs.length; index++) {
  let tab = tabs[index];
  let tabs_items = tab.querySelectorAll("._tabs-item");
  let tabs_blocks = tab.querySelectorAll("._tabs-block");
  for (let index = 0; index < tabs_items.length; index++) {
    let tabs_item = tabs_items[index];
    tabs_item.addEventListener("click", function (e) {
      for (let index = 0; index < tabs_items.length; index++) {
        let tabs_item = tabs_items[index];
        tabs_item.classList.remove("_active");
        tabs_blocks[index].classList.remove("_active");
      }
      tabs_item.classList.add("_active");
      tabs_blocks[index].classList.add("_active");
      e.preventDefault();
    });
  }
}
//=================
/*
Для родителя слойлеров пишем атрибут data-spollers
Для заголовков слойлеров пишем атрибут data-spoller
Если нужно включать\выключать работу спойлеров на разных размерах экранов
пишем параметры ширины и типа брейкпоинта.
Например: 
data-spollers="992,max" - спойлеры будут работать только на экранах меньше или равно 992px
data-spollers="768,min" - спойлеры будут работать только на экранах больше или равно 768px

Если нужно что бы в блоке открывался болько один слойлер добавляем атрибут data-one-spoller
*/

// SPOLLERS
const spollersArray = document.querySelectorAll("[data-spollers]");
if (spollersArray.length > 0) {
  // Получение обычных слойлеров
  const spollersRegular = Array.from(spollersArray).filter(function (item, index, self) {
    return !item.dataset.spollers.split(",")[0];
  });
  // Инициализация обычных слойлеров
  if (spollersRegular.length > 0) {
    initSpollers(spollersRegular);
  }

  // Получение слойлеров с медиа запросами
  const spollersMedia = Array.from(spollersArray).filter(function (item, index, self) {
    return item.dataset.spollers.split(",")[0];
  });

  // Инициализация слойлеров с медиа запросами
  if (spollersMedia.length > 0) {
    const breakpointsArray = [];
    spollersMedia.forEach((item) => {
      const params = item.dataset.spollers;
      const breakpoint = {};
      const paramsArray = params.split(",");
      breakpoint.value = paramsArray[0];
      breakpoint.type = paramsArray[1] ? paramsArray[1].trim() : "max";
      breakpoint.item = item;
      breakpointsArray.push(breakpoint);
    });

    // Получаем уникальные брейкпоинты
    let mediaQueries = breakpointsArray.map(function (item) {
      return "(" + item.type + "-width: " + item.value + "px)," + item.value + "," + item.type;
    });
    mediaQueries = mediaQueries.filter(function (item, index, self) {
      return self.indexOf(item) === index;
    });

    // Работаем с каждым брейкпоинтом
    mediaQueries.forEach((breakpoint) => {
      const paramsArray = breakpoint.split(",");
      const mediaBreakpoint = paramsArray[1];
      const mediaType = paramsArray[2];
      const matchMedia = window.matchMedia(paramsArray[0]);

      // Объекты с нужными условиями
      const spollersArray = breakpointsArray.filter(function (item) {
        if (item.value === mediaBreakpoint && item.type === mediaType) {
          return true;
        }
      });
      // Событие
      matchMedia.addListener(function () {
        initSpollers(spollersArray, matchMedia);
      });
      initSpollers(spollersArray, matchMedia);
    });
  }
  // Инициализация
  function initSpollers(spollersArray, matchMedia = false) {
    spollersArray.forEach((spollersBlock) => {
      spollersBlock = matchMedia ? spollersBlock.item : spollersBlock;
      if (matchMedia.matches || !matchMedia) {
        spollersBlock.classList.add("_init");
        initSpollerBody(spollersBlock);
        spollersBlock.addEventListener("click", setSpollerAction);
      } else {
        spollersBlock.classList.remove("_init");
        initSpollerBody(spollersBlock, false);
        spollersBlock.removeEventListener("click", setSpollerAction);
      }
    });
  }
  // Работа с контентом
  function initSpollerBody(spollersBlock, hideSpollerBody = true) {
    const spollerTitles = spollersBlock.querySelectorAll("[data-spoller]");
    if (spollerTitles.length > 0) {
      spollerTitles.forEach((spollerTitle) => {
        if (hideSpollerBody) {
          spollerTitle.removeAttribute("tabindex");
          if (!spollerTitle.classList.contains("_active")) {
            spollerTitle.nextElementSibling.hidden = true;
          }
        } else {
          spollerTitle.setAttribute("tabindex", "-1");
          spollerTitle.nextElementSibling.hidden = false;
        }
      });
    }
  }
  function setSpollerAction(e) {
    const el = e.target;
    if (el.hasAttribute("data-spoller") || el.closest("[data-spoller]")) {
      const spollerTitle = el.hasAttribute("data-spoller") ? el : el.closest("[data-spoller]");
      const spollersBlock = spollerTitle.closest("[data-spollers]");
      const oneSpoller = spollersBlock.hasAttribute("data-one-spoller") ? true : false;
      if (!spollersBlock.querySelectorAll("._slide").length) {
        if (oneSpoller && !spollerTitle.classList.contains("_active")) {
          hideSpollersBody(spollersBlock);
        }
        spollerTitle.classList.toggle("_active");
        _slideToggle(spollerTitle.nextElementSibling, 500);
      }
      e.preventDefault();
    }
  }
  function hideSpollersBody(spollersBlock) {
    const spollerActiveTitle = spollersBlock.querySelector("[data-spoller]._active");
    if (spollerActiveTitle) {
      spollerActiveTitle.classList.remove("_active");
      _slideUp(spollerActiveTitle.nextElementSibling, 500);
    }
  }
}
//=================
//Gallery
let gallery = document.querySelectorAll("._gallery");
if (gallery) {
  gallery_init();
}
function gallery_init() {
  for (let index = 0; index < gallery.length; index++) {
    const el = gallery[index];
    lightGallery(el, {
      counter: false,
      selector: "a",
      download: false,
    });
  }
}
//=================
//SearchInList
function search_in_list(input) {
  let ul = input.parentNode.querySelector("ul");
  let li = ul.querySelectorAll("li");
  let filter = input.value.toUpperCase();

  for (i = 0; i < li.length; i++) {
    let el = li[i];
    let item = el;
    txtValue = item.textContent || item.innerText;
    if (txtValue.toUpperCase().indexOf(filter) > -1) {
      el.style.display = "";
    } else {
      el.style.display = "none";
    }
  }
}
//=================
//DigiFormat
function digi(str) {
  var r = str.toString().replace(/(\d)(?=(\d\d\d)+([^\d]|$))/g, "$1 ");
  return r;
}
//=================
//DiGiAnimate
function digi_animate(digi_animate) {
  if (digi_animate.length > 0) {
    for (let index = 0; index < digi_animate.length; index++) {
      const el = digi_animate[index];
      const el_to = parseInt(el.innerHTML.replace(" ", ""));
      if (!el.classList.contains("_done")) {
        digi_animate_value(el, 0, el_to, 1500);
      }
    }
  }
}
function digi_animate_value(el, start, end, duration) {
  var obj = el;
  var range = end - start;
  // no timer shorter than 50ms (not really visible any way)
  var minTimer = 50;
  // calc step time to show all interediate values
  var stepTime = Math.abs(Math.floor(duration / range));

  // never go below minTimer
  stepTime = Math.max(stepTime, minTimer);

  // get current time and calculate desired end time
  var startTime = new Date().getTime();
  var endTime = startTime + duration;
  var timer;

  function run() {
    var now = new Date().getTime();
    var remaining = Math.max((endTime - now) / duration, 0);
    var value = Math.round(end - remaining * range);
    obj.innerHTML = digi(value);
    if (value == end) {
      clearInterval(timer);
    }
  }

  timer = setInterval(run, stepTime);
  run();

  el.classList.add("_done");
}
//=================
//Popups
let popup_link = document.querySelectorAll("._popup-link");
let popups = document.querySelectorAll(".popup");
for (let index = 0; index < popup_link.length; index++) {
  const el = popup_link[index];
  el.addEventListener("click", function (e) {
    if (unlock) {
      let item = el.getAttribute("href").replace("#", "");
      let video = el.getAttribute("data-video");
      popup_open(item, video);
    }
    e.preventDefault();
  });
}
for (let index = 0; index < popups.length; index++) {
  const popup = popups[index];
  popup.addEventListener("click", function (e) {
    if (!e.target.closest(".popup__body")) {
      popup_close(e.target.closest(".popup"));
    }
  });
}
function popup_open(item, video = "") {
  let activePopup = document.querySelectorAll(".popup._active");
  if (activePopup.length > 0) {
    popup_close("", false);
  }
  let curent_popup = document.querySelector(".popup_" + item);
  if (curent_popup && unlock) {
    if (video != "" && video != null) {
      let popup_video = document.querySelector(".popup_video");
      popup_video.querySelector(".popup__video").innerHTML =
        '<iframe src="https://www.youtube.com/embed/' +
        video +
        '?autoplay=1"  allow="autoplay; encrypted-media" allowfullscreen></iframe>';
    }
    if (!document.querySelector(".menu__body._active")) {
      body_lock_add(500);
    }
    curent_popup.classList.add("_active");
    history.pushState("", "", "#" + item);
  }
}
function popup_close(item, bodyUnlock = true) {
  if (unlock) {
    if (!item) {
      for (let index = 0; index < popups.length; index++) {
        const popup = popups[index];
        let video = popup.querySelector(".popup__video");
        if (video) {
          video.innerHTML = "";
        }
        popup.classList.remove("_active");
      }
    } else {
      let video = item.querySelector(".popup__video");
      if (video) {
        video.innerHTML = "";
      }
      item.classList.remove("_active");
    }
    if (!document.querySelector(".menu__body._active") && bodyUnlock) {
      body_lock_remove(500);
    }
    history.pushState("", "", window.location.href.split("#")[0]);
  }
}
let popup_close_icon = document.querySelectorAll(".popup__close,._popup-close");
if (popup_close_icon) {
  for (let index = 0; index < popup_close_icon.length; index++) {
    const el = popup_close_icon[index];
    el.addEventListener("click", function () {
      popup_close(el.closest(".popup"));
    });
  }
}
document.addEventListener("keydown", function (e) {
  if (e.code === "Escape") {
    popup_close();
  }
});

//=================
//SlideToggle
let _slideUp = (target, duration = 500) => {
  if (!target.classList.contains("_slide")) {
    target.classList.add("_slide");
    target.style.transitionProperty = "height, margin, padding";
    target.style.transitionDuration = duration + "ms";
    target.style.height = target.offsetHeight + "px";
    target.offsetHeight;
    target.style.overflow = "hidden";
    target.style.height = 0;
    target.style.paddingTop = 0;
    target.style.paddingBottom = 0;
    target.style.marginTop = 0;
    target.style.marginBottom = 0;
    window.setTimeout(() => {
      target.hidden = true;
      target.style.removeProperty("height");
      target.style.removeProperty("padding-top");
      target.style.removeProperty("padding-bottom");
      target.style.removeProperty("margin-top");
      target.style.removeProperty("margin-bottom");
      target.style.removeProperty("overflow");
      target.style.removeProperty("transition-duration");
      target.style.removeProperty("transition-property");
      target.classList.remove("_slide");
    }, duration);
  }
};
let _slideDown = (target, duration = 500) => {
  if (!target.classList.contains("_slide")) {
    target.classList.add("_slide");
    if (target.hidden) {
      target.hidden = false;
    }
    let height = target.offsetHeight;
    target.style.overflow = "hidden";
    target.style.height = 0;
    target.style.paddingTop = 0;
    target.style.paddingBottom = 0;
    target.style.marginTop = 0;
    target.style.marginBottom = 0;
    target.offsetHeight;
    target.style.transitionProperty = "height, margin, padding";
    target.style.transitionDuration = duration + "ms";
    target.style.height = height + "px";
    target.style.removeProperty("padding-top");
    target.style.removeProperty("padding-bottom");
    target.style.removeProperty("margin-top");
    target.style.removeProperty("margin-bottom");
    window.setTimeout(() => {
      target.style.removeProperty("height");
      target.style.removeProperty("overflow");
      target.style.removeProperty("transition-duration");
      target.style.removeProperty("transition-property");
      target.classList.remove("_slide");
    }, duration);
  }
};
let _slideToggle = (target, duration = 500) => {
  if (target.hidden) {
    return _slideDown(target, duration);
  } else {
    return _slideUp(target, duration);
  }
};
//========================================
//Wrap
function _wrap(el, wrapper) {
  el.parentNode.insertBefore(wrapper, el);
  wrapper.appendChild(el);
}
//========================================
//RemoveClasses
function _removeClasses(el, class_name) {
  for (var i = 0; i < el.length; i++) {
    el[i].classList.remove(class_name);
  }
}
//========================================
//IsHidden
function _is_hidden(el) {
  return el.offsetParent === null;
}
// ShowMore Beta ========================
let moreBlocks = document.querySelectorAll("._more-block");
if (moreBlocks.length > 0) {
  let wrapper = document.querySelector(".wrapper");
  for (let index = 0; index < moreBlocks.length; index++) {
    const moreBlock = moreBlocks[index];
    let items = moreBlock.querySelectorAll("._more-item");
    if (items.length > 0) {
      let itemsMore = moreBlock.querySelector("._more-link");
      let itemsContent = moreBlock.querySelector("._more-content");
      let itemsView = itemsContent.getAttribute("data-view");
      if (getComputedStyle(itemsContent).getPropertyValue("transition-duration") === "0s") {
        itemsContent.style.cssText = "transition-duration: 1ms";
      }
      itemsMore.addEventListener("click", function (e) {
        if (itemsMore.classList.contains("_active")) {
          setSize();
        } else {
          setSize("start");
        }
        itemsMore.classList.toggle("_active");
        e.preventDefault();
      });

      let isScrollStart;
      function setSize(type) {
        let resultHeight;
        let itemsContentHeight = 0;
        let itemsContentStartHeight = 0;

        for (let index = 0; index < items.length; index++) {
          if (index < itemsView) {
            itemsContentHeight += items[index].offsetHeight;
          }
          itemsContentStartHeight += items[index].offsetHeight;
        }
        resultHeight = type === "start" ? itemsContentStartHeight : itemsContentHeight;
        isScrollStart = window.innerWidth - wrapper.offsetWidth;
        itemsContent.style.height = `${resultHeight}px`;
      }

      itemsContent.addEventListener("transitionend", updateSize, false);

      function updateSize() {
        let isScrollEnd = window.innerWidth - wrapper.offsetWidth;
        if ((isScrollStart === 0 && isScrollEnd > 0) || (isScrollStart > 0 && isScrollEnd === 0)) {
          if (itemsMore.classList.contains("_active")) {
            setSize("start");
          } else {
            setSize();
          }
        }
      }
      window.addEventListener("resize", function (e) {
        if (!itemsMore.classList.contains("_active")) {
          setSize();
        } else {
          setSize("start");
        }
      });
      setSize();
    }
  }
}
//==RATING======================================
const ratings = document.querySelectorAll(".rating");
if (ratings.length > 0) {
  initRatings();
}
// Основная функция
function initRatings() {
  let ratingActive, ratingValue;
  // "Бегаем" по всем рейтингам на странице
  for (let index = 0; index < ratings.length; index++) {
    const rating = ratings[index];
    initRating(rating);
  }

  // Инициализируем конкретный рейтинг
  function initRating(rating) {
    initRatingVars(rating);

    setRatingActiveWidth();

    if (rating.classList.contains("rating_set")) {
      setRating(rating);
    }
  }

  // Инициализайция переменных
  function initRatingVars(rating) {
    ratingActive = rating.querySelector(".rating__active");
    ratingValue = rating.querySelector(".rating__value");
  }
  // Изменяем ширину активных звезд
  function setRatingActiveWidth(index = ratingValue.innerHTML) {
    const ratingActiveWidth = index / 0.05;
    ratingActive.style.width = `${ratingActiveWidth}%`;
  }
  // Возможность указать оценку
  function setRating(rating) {
    const ratingItems = rating.querySelectorAll(".rating__item");
    for (let index = 0; index < ratingItems.length; index++) {
      const ratingItem = ratingItems[index];
      ratingItem.addEventListener("mouseenter", function (e) {
        // Обновление переменных
        initRatingVars(rating);
        // Обновление активных звезд
        setRatingActiveWidth(ratingItem.value);
      });
      ratingItem.addEventListener("mouseleave", function (e) {
        // Обновление активных звезд
        setRatingActiveWidth();
      });
      ratingItem.addEventListener("click", function (e) {
        // Обновление переменных
        initRatingVars(rating);

        if (rating.dataset.ajax) {
          // "Отправить" на сервер
          setRatingValue(ratingItem.value, rating);
        } else {
          // Отобразить указанную оцнку
          ratingValue.innerHTML = index + 1;
          setRatingActiveWidth();
        }
      });
    }
  }

  async function setRatingValue(value, rating) {
    if (!rating.classList.contains("rating_sending")) {
      rating.classList.add("rating_sending");

      // Отправика данных (value) на сервер
      let response = await fetch("rating.json", {
        method: "GET",

        //body: JSON.stringify({
        //	userRating: value
        //}),
        //headers: {
        //	'content-type': 'application/json'
        //}
      });
      if (response.ok) {
        const result = await response.json();

        // Получаем новый рейтинг
        const newRating = result.newRating;

        // Вывод нового среднего результата
        ratingValue.innerHTML = newRating;

        // Обновление активных звезд
        setRatingActiveWidth();

        rating.classList.remove("rating_sending");
      } else {
        alert("Ошибка");

        rating.classList.remove("rating_sending");
      }
    }
  }
}
//========================================
//Animate
function animate({ timing, draw, duration }) {
  let start = performance.now();
  requestAnimationFrame(function animate(time) {
    // timeFraction изменяется от 0 до 1
    let timeFraction = (time - start) / duration;
    if (timeFraction > 1) timeFraction = 1;

    // вычисление текущего состояния анимации
    let progress = timing(timeFraction);

    draw(progress); // отрисовать её

    if (timeFraction < 1) {
      requestAnimationFrame(animate);
    }
  });
}
function makeEaseOut(timing) {
  return function (timeFraction) {
    return 1 - timing(1 - timeFraction);
  };
}
function makeEaseInOut(timing) {
  return function (timeFraction) {
    if (timeFraction < 0.5) return timing(2 * timeFraction) / 2;
    else return (2 - timing(2 * (1 - timeFraction))) / 2;
  };
}
function quad(timeFraction) {
  return Math.pow(timeFraction, 2);
}
function circ(timeFraction) {
  return 1 - Math.sin(Math.acos(timeFraction));
}
/*
animate({
  duration: 1000,
  timing: makeEaseOut(quad),
  draw(progress) {
    window.scroll(0, start_position + 400 * progress);
  }
});*/

//Полифилы
(function () {
  // проверяем поддержку
  if (!Element.prototype.closest) {
    // реализуем
    Element.prototype.closest = function (css) {
      var node = this;
      while (node) {
        if (node.matches(css)) return node;
        else node = node.parentElement;
      }
      return null;
    };
  }
})();
(function () {
  // проверяем поддержку
  if (!Element.prototype.matches) {
    // определяем свойство
    Element.prototype.matches =
      Element.prototype.matchesSelector ||
      Element.prototype.webkitMatchesSelector ||
      Element.prototype.mozMatchesSelector ||
      Element.prototype.msMatchesSelector;
  }
})();

//let btn = document.querySelectorAll('button[type="submit"],input[type="submit"]');
let forms = document.querySelectorAll("form");
if (forms.length > 0) {
  for (let index = 0; index < forms.length; index++) {
    const el = forms[index];
    el.addEventListener("submit", form_submit);
  }
}
async function form_submit(e) {
  let btn = e.target;
  let form = btn.closest("form");
  let error = form_validate(form);
  if (error == 0) {
    let formAction = form.getAttribute("action") ? form.getAttribute("action").trim() : "#";
    let formMethod = form.getAttribute("method") ? form.getAttribute("method").trim() : "GET";
    const message = form.getAttribute("data-message");
    const ajax = form.getAttribute("data-ajax");

    //SendForm
    if (ajax) {
      e.preventDefault();
      let formData = new FormData(form);
      form.classList.add("_sending");
      let response = await fetch(formAction, {
        method: formMethod,
        body: formData,
      });
      if (response.ok) {
        let result = await response.json();
        form.classList.remove("_sending");
        if (message) {
          popup_open(message + "-message");
        }
        form_clean(form);
      } else {
        alert("Ошибка");
        form.classList.remove("_sending");
      }
    }
    // If test
    if (form.hasAttribute("data-test")) {
      e.preventDefault();
      if (message) {
        popup_open(message + "-message");
      }
      form_clean(form);
    }
  } else {
    let form_error = form.querySelectorAll("._error");
    if (form_error && form.classList.contains("_goto-error")) {
      _goto(form_error[0], 1000, 50);
    }
    e.preventDefault();
  }
}
function form_validate(form) {
  let error = 0;
  let form_req = form.querySelectorAll("._req");
  if (form_req.length > 0) {
    for (let index = 0; index < form_req.length; index++) {
      const el = form_req[index];
      if (!_is_hidden(el)) {
        error += form_validate_input(el);
      }
    }
  }
  return error;
}
function form_validate_input(input) {
  let error = 0;
  let input_g_value = input.getAttribute("data-value");

  if (input.getAttribute("name") == "email" || input.classList.contains("_email")) {
    if (input.value != input_g_value) {
      let em = input.value.replace(" ", "");
      input.value = em;
    }
    if (email_test(input) || input.value == input_g_value) {
      form_add_error(input);
      error++;
    } else {
      form_remove_error(input);
    }
  } else if (input.getAttribute("type") == "checkbox" && input.checked == false) {
    form_add_error(input);
    error++;
  } else {
    if (input.value == "" || input.value == input_g_value) {
      form_add_error(input);
      error++;
    } else {
      form_remove_error(input);
    }
  }
  return error;
}
function form_add_error(input) {
  input.classList.add("_error");
  input.parentElement.classList.add("_error");

  let input_error = input.parentElement.querySelector(".form__error");
  if (input_error) {
    input.parentElement.removeChild(input_error);
  }
  let input_error_text = input.getAttribute("data-error");
  if (input_error_text && input_error_text != "") {
    input.parentElement.insertAdjacentHTML("beforeend", '<div class="form__error">' + input_error_text + "</div>");
  }
}
function form_remove_error(input) {
  input.classList.remove("_error");
  input.parentElement.classList.remove("_error");

  let input_error = input.parentElement.querySelector(".form__error");
  if (input_error) {
    input.parentElement.removeChild(input_error);
  }
}
function form_clean(form) {
  let inputs = form.querySelectorAll("input,textarea");
  for (let index = 0; index < inputs.length; index++) {
    const el = inputs[index];
    el.parentElement.classList.remove("_focus");
    el.classList.remove("_focus");
    el.value = el.getAttribute("data-value");
  }
  let checkboxes = form.querySelectorAll(".checkbox__input");
  if (checkboxes.length > 0) {
    for (let index = 0; index < checkboxes.length; index++) {
      const checkbox = checkboxes[index];
      checkbox.checked = false;
    }
  }
  let selects = form.querySelectorAll("select");
  if (selects.length > 0) {
    for (let index = 0; index < selects.length; index++) {
      const select = selects[index];
      const select_default_value = select.getAttribute("data-default");
      select.value = select_default_value;
      select_item(select);
    }
  }
}

//viewPass
let viewPass = document.querySelectorAll("._viewpass");
for (let index = 0; index < viewPass.length; index++) {
  const element = viewPass[index];
  element.addEventListener("click", function (e) {
    if (element.classList.contains("_active")) {
      element.parentElement.querySelector("input").setAttribute("type", "password");
    } else {
      element.parentElement.querySelector("input").setAttribute("type", "text");
    }
    element.classList.toggle("_active");
  });
}

//Select
let selects = document.getElementsByTagName("select");
if (selects.length > 0) {
  selects_init();
}
function selects_init() {
  for (let index = 0; index < selects.length; index++) {
    const select = selects[index];
    select_init(select);
  }
  //select_callback();
  document.addEventListener("click", function (e) {
    selects_close(e);
  });
  document.addEventListener("keydown", function (e) {
    if (e.code === "Escape") {
      selects_close(e);
    }
  });
}
function selects_close(e) {
  const selects = document.querySelectorAll(".select");
  if (!e.target.closest(".select") && !e.target.classList.contains("_option")) {
    for (let index = 0; index < selects.length; index++) {
      const select = selects[index];
      const select_body_options = select.querySelector(".select__options");
      select.classList.remove("_active");
      _slideUp(select_body_options, 100);
    }
  }
}
function select_init(select) {
  const select_parent = select.parentElement;
  const select_modifikator = select.getAttribute("class");
  const select_selected_option = select.querySelector("option:checked");
  select.setAttribute("data-default", select_selected_option.value);
  select.style.display = "none";

  select_parent.insertAdjacentHTML("beforeend", '<div class="select select_' + select_modifikator + '"></div>');

  let new_select = select.parentElement.querySelector(".select");
  new_select.appendChild(select);
  select_item(select);
}
function select_item(select) {
  const select_parent = select.parentElement;
  const select_items = select_parent.querySelector(".select__item");
  const select_options = select.querySelectorAll("option");
  const select_selected_option = select.querySelector("option:checked");
  const select_selected_text = select_selected_option.text;
  const select_type = select.getAttribute("data-type");

  if (select_items) {
    select_items.remove();
  }

  let select_type_content = "";
  if (select_type == "input") {
    select_type_content =
      '<div class="select__value icon-select-arrow"><input autocomplete="off" type="text" name="form[]" value="' +
      select_selected_text +
      '" data-error="Ошибка" data-value="' +
      select_selected_text +
      '" class="select__input"></div>';
  } else {
    select_type_content =
      '<div class="select__value icon-select-arrow"><span>' + select_selected_text + "</span></div>";
  }

  select_parent.insertAdjacentHTML(
    "beforeend",
    '<div class="select__item">' +
    '<div class="select__title">' +
    select_type_content +
    "</div>" +
    '<div hidden class="select__options">' +
    select_get_options(select_options) +
    "</div>" +
    "</div></div>"
  );

  select_actions(select, select_parent);
}
function select_actions(original, select) {
  const select_item = select.querySelector(".select__item");
  const selectTitle = select.querySelector(".select__title");
  const select_body_options = select.querySelector(".select__options");
  const select_options = select.querySelectorAll(".select__option");
  const select_type = original.getAttribute("data-type");
  const select_input = select.querySelector(".select__input");

  selectTitle.addEventListener("click", function (e) {
    selectItemActions();
  });

  function selectMultiItems() {
    let selectedOptions = select.querySelectorAll(".select__option");
    let originalOptions = original.querySelectorAll("option");
    let selectedOptionsText = [];
    for (let index = 0; index < selectedOptions.length; index++) {
      const selectedOption = selectedOptions[index];
      originalOptions[index].removeAttribute("selected");
      if (selectedOption.classList.contains("_selected")) {
        const selectOptionText = selectedOption.innerHTML;
        selectedOptionsText.push(selectOptionText);
        originalOptions[index].setAttribute("selected", "selected");
      }
    }
    select.querySelector(".select__value").innerHTML = "<span>" + selectedOptionsText + "</span>";
  }
  function selectItemActions(type) {
    if (!type) {
      let selects = document.querySelectorAll(".select");
      for (let index = 0; index < selects.length; index++) {
        const select = selects[index];
        const select_body_options = select.querySelector(".select__options");
        if (select != select_item.closest(".select")) {
          select.classList.remove("_active");
          _slideUp(select_body_options, 100);
        }
      }
      _slideToggle(select_body_options, 100);
      select.classList.toggle("_active");
    }
  }
  for (let index = 0; index < select_options.length; index++) {
    const select_option = select_options[index];
    const select_option_value = select_option.getAttribute("data-value");
    const select_option_text = select_option.innerHTML;

    if (select_type == "input") {
      select_input.addEventListener("keyup", select_search);
    } else {
      if (select_option.getAttribute("data-value") == original.value && !original.hasAttribute("multiple")) {
        select_option.style.display = "none";
      }
    }
    select_option.addEventListener("click", function () {
      for (let index = 0; index < select_options.length; index++) {
        const el = select_options[index];
        el.style.display = "block";
      }
      if (select_type == "input") {
        select_input.value = select_option_text;
        original.value = select_option_value;
      } else {
        if (original.hasAttribute("multiple")) {
          select_option.classList.toggle("_selected");
          selectMultiItems();
        } else {
          select.querySelector(".select__value").innerHTML = "<span>" + select_option_text + "</span>";
          original.value = select_option_value;
          select_option.style.display = "none";
        }
      }
      let type;
      if (original.hasAttribute("multiple")) {
        type = "multiple";
      }
      selectItemActions(type);
    });
  }
}
function select_get_options(select_options) {
  if (select_options) {
    let select_options_content = "";
    for (let index = 0; index < select_options.length; index++) {
      const select_option = select_options[index];
      const select_option_value = select_option.value;
      if (select_option_value != "") {
        const select_option_text = select_option.innerHTML;
        select_options_content =
          select_options_content +
          '<div data-value="' +
          select_option_value +
          '" class="select__option">' +
          select_option_text +
          "</div>";
      }
    }
    return select_options_content;
  }
}
function select_search(e) {
  let select_block = e.target.closest(".select ").querySelector(".select__options");
  let select_options = e.target.closest(".select ").querySelectorAll(".select__option");
  let select_search_text = e.target.value.toUpperCase();

  for (let i = 0; i < select_options.length; i++) {
    let select_option = select_options[i];
    let select_txt_value = select_option.textContent || select_option.innerText;
    if (select_txt_value.toUpperCase().indexOf(select_search_text) > -1) {
      select_option.style.display = "";
    } else {
      select_option.style.display = "none";
    }
  }
}
function selects_update_all() {
  let selects = document.querySelectorAll("select");
  if (selects) {
    for (let index = 0; index < selects.length; index++) {
      const select = selects[index];
      select_item(select);
    }
  }
}

//Placeholers
let inputs = document.querySelectorAll("input[data-value],textarea[data-value]");
inputs_init(inputs);

function inputs_init(inputs) {
  if (inputs.length > 0) {
    for (let index = 0; index < inputs.length; index++) {
      const input = inputs[index];
      const input_g_value = input.getAttribute("data-value");
      input_placeholder_add(input);
      if (input.value != "" && input.value != input_g_value) {
        input_focus_add(input);
      }
      input.addEventListener("focus", function (e) {
        if (input.value == input_g_value) {
          input_focus_add(input);
          input.value = "";
        }
        if (input.getAttribute("data-type") === "pass") {
          if (input.parentElement.querySelector("._viewpass")) {
            if (!input.parentElement.querySelector("._viewpass").classList.contains("_active")) {
              input.setAttribute("type", "password");
            }
          } else {
            input.setAttribute("type", "password");
          }
        }
        if (input.classList.contains("_date")) {
          /*
     input.classList.add('_mask');
     Inputmask("99.99.9999", {
       //"placeholder": '',
       clearIncomplete: true,
       clearMaskOnLostFocus: true,
       onincomplete: function () {
         input_clear_mask(input, input_g_value);
       }
     }).mask(input);
     */
        }
        if (input.classList.contains("_phone")) {
          //'+7(999) 999 9999'
          //'+38(999) 999 9999'
          //'+375(99)999-99-99'
          input.classList.add("_mask");
          Inputmask("+375 (99) 9999999", {
            //"placeholder": '',
            clearIncomplete: true,
            clearMaskOnLostFocus: true,
            onincomplete: function () {
              input_clear_mask(input, input_g_value);
            },
          }).mask(input);
        }
        if (input.classList.contains("_digital")) {
          input.classList.add("_mask");
          Inputmask("9{1,}", {
            placeholder: "",
            clearIncomplete: true,
            clearMaskOnLostFocus: true,
            onincomplete: function () {
              input_clear_mask(input, input_g_value);
            },
          }).mask(input);
        }
        form_remove_error(input);
      });
      input.addEventListener("blur", function (e) {
        if (input.value == "") {
          input.value = input_g_value;
          input_focus_remove(input);
          if (input.classList.contains("_mask")) {
            input_clear_mask(input, input_g_value);
          }
          if (input.getAttribute("data-type") === "pass") {
            input.setAttribute("type", "text");
          }
        }
      });
      if (input.classList.contains("_date")) {
        const calendarItem = datepicker(input, {
          customDays: ["Пн", "Вт", "Ср", "Чт", "Пт", "Сб", "Вс"],
          customMonths: ["Янв", "Фев", "Мар", "Апр", "Май", "Июн", "Июл", "Авг", "Сен", "Окт", "Ноя", "Дек"],
          overlayButton: "Применить",
          overlayPlaceholder: "Год (4 цифры)",
          startDay: 1,
          formatter: (input, date, instance) => {
            const value = date.toLocaleDateString();
            input.value = value;
          },
          onSelect: function (input, instance, date) {
            input_focus_add(input.el);
          },
        });
        const dataFrom = input.getAttribute("data-from");
        const dataTo = input.getAttribute("data-to");
        if (dataFrom) {
          calendarItem.setMin(new Date(dataFrom));
        }
        if (dataTo) {
          calendarItem.setMax(new Date(dataTo));
        }
      }
    }
  }
}
function input_placeholder_add(input) {
  const input_g_value = input.getAttribute("data-value");
  if (input.value == "" && input_g_value != "") {
    input.value = input_g_value;
  }
}
function input_focus_add(input) {
  input.classList.add("_focus");
  input.parentElement.classList.add("_focus");
}
function input_focus_remove(input) {
  input.classList.remove("_focus");
  input.parentElement.classList.remove("_focus");
}
function input_clear_mask(input, input_g_value) {
  input.inputmask.remove();
  input.value = input_g_value;
  input_focus_remove(input);
}

//QUANTITY
let quantityButtons = document.querySelectorAll(".quantity__button");
if (quantityButtons.length > 0) {
  for (let index = 0; index < quantityButtons.length; index++) {
    const quantityButton = quantityButtons[index];
    quantityButton.addEventListener("click", function (e) {
      let value = parseInt(quantityButton.closest(".quantity").querySelector("input").value);
      if (quantityButton.classList.contains("quantity__button_plus")) {
        value++;
      } else {
        value = value - 1;
        if (value < 1) {
          value = 1;
        }
      }
      quantityButton.closest(".quantity").querySelector("input").value = value;
    });
  }
}

//RANGE
const priceSlider = document.querySelector(".price-filter__slider");
if (priceSlider) {
  let textFrom = priceSlider.getAttribute("data-from");
  let textTo = priceSlider.getAttribute("data-to");

  noUiSlider.create(priceSlider, {
    start: [0, 200000],
    connect: true,
    tooltips: [wNumb({ decimals: 0, prefix: textFrom + " " }), wNumb({ decimals: 0, prefix: textTo + " " })],
    range: {
      min: [0],
      max: [200000],
    },
  });

  /*
 const priceStart = document.getElementById('price-start');
 const priceEnd = document.getElementById('price-end');
 priceStart.addEventListener('change', setPriceValues);
 priceEnd.addEventListener('change', setPriceValues);
 */

  function setPriceValues() {
    let priceStartValue;
    let priceEndValue;
    if (priceStart.value != "") {
      priceStartValue = priceStart.value;
    }
    if (priceEnd.value != "") {
      priceEndValue = priceEnd.value;
    }
    priceSlider.noUiSlider.set([priceStartValue, priceEndValue]);
  }
}
let scr_body = document.querySelector("body");
let scr_blocks = document.querySelectorAll("._scr-sector");
let scr_items = document.querySelectorAll("._scr-item");
let scr_fix_block = document.querySelectorAll("._side-wrapper");
let scr_min_height = 750;

let scrolling = true;
let scrolling_full = true;

let scrollDirection = 0;

let currentScroll;

//ScrollOnScroll
window.addEventListener("scroll", scroll_scroll);
function scroll_scroll() {
  let src_value = (currentScroll = pageYOffset);
  let header = document.querySelector("header.header");
  if (header !== null) {
    if (src_value > 10) {
      header.classList.add("_scroll");
    } else {
      header.classList.remove("_scroll");
    }
  }
  if (scr_blocks.length > 0) {
    for (let index = 0; index < scr_blocks.length; index++) {
      let block = scr_blocks[index];
      let block_offset = offset(block).top;
      let block_height = block.offsetHeight;

      /*
   if ((src_value > block_offset - block_height) && src_value < (block_offset + block_height) && window.innerHeight > scr_min_height && window.innerWidth > 992) {
     let scrProcent = (src_value - block_offset) / block_height * 100;
     scrParallax(block, scrProcent, block_height);
   }
   */

      if (
        pageYOffset > block_offset - window.innerHeight / 1.5 &&
        pageYOffset < block_offset + block_height - window.innerHeight / 5
      ) {
        block.classList.add("_scr-sector_active");
      } else {
        if (block.classList.contains("_scr-sector_active")) {
          block.classList.remove("_scr-sector_active");
        }
      }
      if (
        pageYOffset > block_offset - window.innerHeight / 2 &&
        pageYOffset < block_offset + block_height - window.innerHeight / 5
      ) {
        if (!block.classList.contains("_scr-sector_current")) {
          block.classList.add("_scr-sector_current");
        }
      } else {
        if (block.classList.contains("_scr-sector_current")) {
          block.classList.remove("_scr-sector_current");
        }
      }
    }
  }
  if (scr_items.length > 0) {
    for (let index = 0; index < scr_items.length; index++) {
      let scr_item = scr_items[index];
      let scr_item_offset = offset(scr_item).top;
      let scr_item_height = scr_item.offsetHeight;

      let scr_item_point = window.innerHeight - (window.innerHeight - scr_item_height / 3);
      if (window.innerHeight > scr_item_height) {
        scr_item_point = window.innerHeight - scr_item_height / 3;
      }

      if (src_value > scr_item_offset - scr_item_point && src_value < scr_item_offset + scr_item_height) {
        scr_item.classList.add("_active");
        scroll_load_item(scr_item);
      } else {
        scr_item.classList.remove("_active");
      }
      if (src_value > scr_item_offset - window.innerHeight) {
        if (scr_item.querySelectorAll("._lazy").length > 0) {
          scroll_lazy(scr_item);
        }
      }
    }
  }
  if (scr_fix_block.length > 0) {
    fix_block(scr_fix_block, src_value);
  }
  let custom_scroll_line = document.querySelector("._custom-scroll__line");
  if (custom_scroll_line) {
    let window_height = window.innerHeight;
    let content_height = document.querySelector(".wrapper").offsetHeight;
    let scr_procent = (pageYOffset / (content_height - window_height)) * 100;
    let custom_scroll_line_height = custom_scroll_line.offsetHeight;
    custom_scroll_line.style.transform =
      "translateY(" + ((window_height - custom_scroll_line_height) / 100) * scr_procent + "px)";
  }
  if (src_value > scrollDirection) {
    // downscroll code
  } else {
    // upscroll code
  }
  scrollDirection = src_value <= 0 ? 0 : src_value;
}
setTimeout(function () {
  //document.addEventListener("DOMContentLoaded", scroll_scroll);
  scroll_scroll();
}, 100);

function scroll_lazy(scr_item) {
  /*
 let lazy_src = scr_item.querySelectorAll('*[data-src]');
 if (lazy_src.length > 0) {
   for (let index = 0; index < lazy_src.length; index++) {
     const el = lazy_src[index];
     if (!el.classList.contains('_loaded')) {
       el.setAttribute('src', el.getAttribute('data-src'));
       el.classList.add('_loaded');
     }
   }
 }
 let lazy_srcset = scr_item.querySelectorAll('*[data-srcset]');
 if (lazy_srcset.length > 0) {
   for (let index = 0; index < lazy_srcset.length; index++) {
     const el = lazy_srcset[index];
     if (!el.classList.contains('_loaded')) {
       el.setAttribute('srcset', el.getAttribute('data-srcset'));
       el.classList.add('_loaded');
     }
   }
 }
 */
  /*
 window.onload = () => {
   const observer = new IntersectionObserver((entries, observer) => {
     entries.forEach(entry => {
       if (entry.isIntersecting) {
         console.log(entry)
         // ссылка на оригинальное изображение хранится в атрибуте "data-src"
         entry.target.src = entry.target.dataset.src
         observer.unobserve(entry.target)
       }
     })
   }, { threshold: 0.5 })

   document.querySelectorAll('img').forEach(img => observer.observe(img))
 }
 */
}
function scroll_load_item(scr_item) {
  if (scr_item.classList.contains("_load-map") && !scr_item.classList.contains("_loaded-map")) {
    let map_item = document.getElementById("map");
    if (map_item) {
      scr_item.classList.add("_loaded-map");
      map();
    }
  }
}
function scrParallax(block, scrProcent, blockHeight) {
  let prlxItems = block.querySelectorAll("._prlx-item");
  if (prlxItems.length > 0) {
    for (let index = 0; index < prlxItems.length; index++) {
      const prlxItem = prlxItems[index];
      let prlxItemAttr = prlxItem.dataset.prlx ? prlxItem.dataset.prlx : 3;
      const prlxItemValue = -1 * (((blockHeight / 100) * scrProcent) / prlxItemAttr);
      prlxItem.style.cssText = `transform: translateY(${prlxItemValue}px);`;
    }
  }
}
//FullScreenScroll
if (scr_blocks.length > 0 && !isMobile.any()) {
  disableScroll();
  window.addEventListener("wheel", full_scroll);

  let swiperScrolls = document.querySelectorAll("._swiper_scroll");

  if (swiperScrolls.length > 0) {
    for (let index = 0; index < swiperScrolls.length; index++) {
      const swiperScroll = swiperScrolls[index];
      swiperScroll.addEventListener("mouseenter", function (e) {
        window.removeEventListener("wheel", full_scroll);
      });
      swiperScroll.addEventListener("mouseleave", function (e) {
        window.addEventListener("wheel", full_scroll);
      });
    }
  }
}
function getPrevBlockPos(current_block_prev) {
  let viewport_height = window.innerHeight;
  let current_block_prev_height = current_block_prev.offsetHeight;
  let block_pos = offset(current_block_prev).top;

  if (current_block_prev_height >= viewport_height) {
    block_pos = block_pos + (current_block_prev_height - viewport_height);
  }
  return block_pos;
}
function full_scroll(e) {
  let viewport_height = window.innerHeight;
  if (viewport_height >= scr_min_height) {
    if (scrolling_full) {
      let current_block = document.querySelector("._scr-sector._scr-sector_current");
      let current_block_pos = offset(current_block).top;
      let current_block_height = current_block.offsetHeight;
      let current_block_next = current_block.nextElementSibling;
      let current_block_prev = current_block.previousElementSibling;
      if (e.keyCode == 40 || e.keyCode == 34 || e.deltaX > 0 || e.deltaY < 0) {
        if (current_block_height <= viewport_height) {
          if (current_block_prev) {
            full_scroll_to_sector(getPrevBlockPos(current_block_prev));
          }
        } else {
          enableScroll();
          if (currentScroll <= current_block_pos) {
            if (current_block_prev) {
              full_scroll_to_sector(getPrevBlockPos(current_block_prev));
            }
          }
        }
      } else if (e.keyCode == 38 || e.keyCode == 33 || e.deltaX < 0 || e.deltaY > 0) {
        if (current_block_height <= viewport_height) {
          if (current_block_next) {
            let block_pos = offset(current_block_next).top;
            full_scroll_to_sector(block_pos);
          }
        } else {
          enableScroll();
          if (current_block_next) {
            let block_pos = offset(current_block_next).top;
            if (currentScroll >= block_pos - viewport_height) {
              full_scroll_to_sector(block_pos);
            }
          }
        }
      }
    } else {
      disableScroll();
    }
  } else {
    enableScroll();
  }
}
function full_scroll_to_sector(pos) {
  disableScroll();
  scrolling_full = false;
  _goto(pos, 800);

  let scr_pause = 500;
  if (navigator.appVersion.indexOf("Mac") != -1) {
    scr_pause = 1000;
  }
  setTimeout(function () {
    scrolling_full = true;
  }, scr_pause);
}
function full_scroll_pagestart() { }
function full_scroll_pageend() { }

//ScrollOnClick (Navigation)
let link = document.querySelectorAll("._goto-block");
if (link) {
  let blocks = [];
  for (let index = 0; index < link.length; index++) {
    let el = link[index];
    let block_name = el.getAttribute("href").replace("#", "");
    if (block_name != "" && !~blocks.indexOf(block_name)) {
      blocks.push(block_name);
    }
    el.addEventListener("click", function (e) {
      if (document.querySelector(".menu__body._active")) {
        menu_close();
        body_lock_remove(500);
      }
      let target_block_class = el.getAttribute("href").replace("#", "");
      let target_block = document.querySelector("." + target_block_class);
      _goto(target_block, 300);
      e.preventDefault();
    });
  }

  window.addEventListener("scroll", function (el) {
    let old_current_link = document.querySelectorAll("._goto-block._active");
    if (old_current_link) {
      for (let index = 0; index < old_current_link.length; index++) {
        let el = old_current_link[index];
        el.classList.remove("_active");
      }
    }
    for (let index = 0; index < blocks.length; index++) {
      let block = blocks[index];
      let block_item = document.querySelector("." + block);
      if (block_item) {
        let block_offset = offset(block_item).top;
        let block_height = block_item.offsetHeight;
        if (
          pageYOffset > block_offset - window.innerHeight / 3 &&
          pageYOffset < block_offset + block_height - window.innerHeight / 3
        ) {
          let current_links = document.querySelectorAll('._goto-block[href="#' + block + '"]');
          for (let index = 0; index < current_links.length; index++) {
            let current_link = current_links[index];
            current_link.classList.add("_active");
          }
        }
      }
    }
  });
}
//ScrollOnClick (Simple)
let goto_links = document.querySelectorAll("._goto");
if (goto_links) {
  for (let index = 0; index < goto_links.length; index++) {
    let goto_link = goto_links[index];
    goto_link.addEventListener("click", function (e) {
      let target_block_class = goto_link.getAttribute("href").replace("#", "");
      let target_block = document.querySelector("." + target_block_class);
      _goto(target_block, 300);
      e.preventDefault();
    });
  }
}
function _goto(target_block, speed, offset = 0) {
  let header = "";
  //OffsetHeader
  //if (window.innerWidth < 992) {
  //	header = 'header';
  //}
  let options = {
    speedAsDuration: true,
    speed: speed,
    header: header,
    offset: offset,
    easing: "easeOutQuad",
  };
  let scr = new SmoothScroll();
  scr.animateScroll(target_block, "", options);
}

//SameFunctions
function offset(el) {
  var rect = el.getBoundingClientRect(),
    scrollLeft = window.pageXOffset || document.documentElement.scrollLeft,
    scrollTop = window.pageYOffset || document.documentElement.scrollTop;
  return { top: rect.top + scrollTop, left: rect.left + scrollLeft };
}
function disableScroll() {
  if (window.addEventListener)
    // older FF
    window.addEventListener("DOMMouseScroll", preventDefault, false);
  document.addEventListener("wheel", preventDefault, { passive: false }); // Disable scrolling in Chrome
  window.onwheel = preventDefault; // modern standard
  window.onmousewheel = document.onmousewheel = preventDefault; // older browsers, IE
  window.ontouchmove = preventDefault; // mobile
  document.onkeydown = preventDefaultForScrollKeys;
}
function enableScroll() {
  if (window.removeEventListener) window.removeEventListener("DOMMouseScroll", preventDefault, false);
  document.removeEventListener("wheel", preventDefault, { passive: false }); // Enable scrolling in Chrome
  window.onmousewheel = document.onmousewheel = null;
  window.onwheel = null;
  window.ontouchmove = null;
  document.onkeydown = null;
}
function preventDefault(e) {
  e = e || window.event;
  if (e.preventDefault) e.preventDefault();
  e.returnValue = false;
}
function preventDefaultForScrollKeys(e) {
  /*if (keys[e.keyCode]) {
   preventDefault(e);
   return false;
 }*/
}

function fix_block(scr_fix_block, scr_value) {
  let window_width = parseInt(window.innerWidth);
  let window_height = parseInt(window.innerHeight);
  let header_height = parseInt(document.querySelector("header").offsetHeight) + 15;
  for (let index = 0; index < scr_fix_block.length; index++) {
    const block = scr_fix_block[index];
    let block_width = block.getAttribute("data-width");
    const item = block.querySelector("._side-block");
    if (!block_width) {
      block_width = 0;
    }
    if (window_width > block_width) {
      if (item.offsetHeight < window_height - (header_height + 30)) {
        if (scr_value > offset(block).top - (header_height + 15)) {
          item.style.cssText =
            "position:fixed;bottom:auto;top:" +
            header_height +
            "px;width:" +
            block.offsetWidth +
            "px;left:" +
            offset(block).left +
            "px;";
        } else {
          gotoRelative(item);
        }
        if (scr_value > block.offsetHeight + offset(block).top - (item.offsetHeight + (header_height + 15))) {
          block.style.cssText = "position:relative;";
          item.style.cssText = "position:absolute;bottom:0;top:auto;left:0px;width:100%";
        }
      } else {
        gotoRelative(item);
      }
    }
  }
  function gotoRelative(item) {
    item.style.cssText = "position:relative;bottom:auto;top:0px;left:0px;";
  }
}

if (!isMobile.any()) {
  //custom_scroll();
  /*
 window.addEventListener('wheel', scroll_animate, {
   capture: true,
   passive: true
 });
 window.addEventListener('resize', custom_scroll, {
   capture: true,
   passive: true
 });
 */
}
function custom_scroll(event) {
  scr_body.style.overflow = "hidden";
  let window_height = window.innerHeight;
  let custom_scroll_line = document.querySelector("._custom-scroll__line");
  let custom_scroll_content_height = document.querySelector(".wrapper").offsetHeight;
  let custom_cursor_height = Math.min(
    window_height,
    Math.round(window_height * (window_height / custom_scroll_content_height))
  );
  if (custom_scroll_content_height > window_height) {
    if (!custom_scroll_line) {
      let custom_scroll = document.createElement("div");
      custom_scroll_line = document.createElement("div");
      custom_scroll.setAttribute("class", "_custom-scroll");
      custom_scroll_line.setAttribute("class", "_custom-scroll__line");
      custom_scroll.appendChild(custom_scroll_line);
      scr_body.appendChild(custom_scroll);
    }
    custom_scroll_line.style.height = custom_cursor_height + "px";
  }
}

let new_pos = pageYOffset;
function scroll_animate(event) {
  let window_height = window.innerHeight;
  let content_height = document.querySelector(".wrapper").offsetHeight;
  let start_position = pageYOffset;
  let pos_add = 100;

  if (event.keyCode == 40 || event.keyCode == 34 || event.deltaX > 0 || event.deltaY < 0) {
    new_pos = new_pos - pos_add;
  } else if (event.keyCode == 38 || event.keyCode == 33 || event.deltaX < 0 || event.deltaY > 0) {
    new_pos = new_pos + pos_add;
  }
  if (new_pos > content_height - window_height) new_pos = content_height - window_height;
  if (new_pos < 0) new_pos = 0;

  if (scrolling) {
    scrolling = false;
    _goto(new_pos, 1000);

    let scr_pause = 100;
    if (navigator.appVersion.indexOf("Mac") != -1) {
      scr_pause = scr_pause * 2;
    }
    setTimeout(function () {
      scrolling = true;
      _goto(new_pos, 1000);
    }, scr_pause);
  }
  //If native scroll
  //disableScroll();
}

// Dynamic Adapt v.1
// HTML data-da="where(uniq class name),when(breakpoint),position(digi)"
// e.x. data-da=".item,992,2"
// Andrikanych Yevhen 2020
// https://www.youtube.com/c/freelancerlifestyle

("use strict");

function DynamicAdapt(type) {
  this.type = type;
}

DynamicAdapt.prototype.init = function () {
  const _this = this;
  // массив объектов
  this.оbjects = [];
  this.daClassname = "_dynamic_adapt_";
  // массив DOM-элементов
  this.nodes = document.querySelectorAll("[data-da]");

  // наполнение оbjects объктами
  for (let i = 0; i < this.nodes.length; i++) {
    const node = this.nodes[i];
    const data = node.dataset.da.trim();
    const dataArray = data.split(",");
    const оbject = {};
    оbject.element = node;
    оbject.parent = node.parentNode;
    оbject.destination = document.querySelector(dataArray[0].trim());
    оbject.breakpoint = dataArray[1] ? dataArray[1].trim() : "767";
    оbject.place = dataArray[2] ? dataArray[2].trim() : "last";
    оbject.index = this.indexInParent(оbject.parent, оbject.element);
    this.оbjects.push(оbject);
  }

  this.arraySort(this.оbjects);

  // массив уникальных медиа-запросов
  this.mediaQueries = Array.prototype.map.call(
    this.оbjects,
    function (item) {
      return "(" + this.type + "-width: " + item.breakpoint + "px)," + item.breakpoint;
    },
    this
  );
  this.mediaQueries = Array.prototype.filter.call(this.mediaQueries, function (item, index, self) {
    return Array.prototype.indexOf.call(self, item) === index;
  });

  // навешивание слушателя на медиа-запрос
  // и вызов обработчика при первом запуске
  for (let i = 0; i < this.mediaQueries.length; i++) {
    const media = this.mediaQueries[i];
    const mediaSplit = String.prototype.split.call(media, ",");
    const matchMedia = window.matchMedia(mediaSplit[0]);
    const mediaBreakpoint = mediaSplit[1];

    // массив объектов с подходящим брейкпоинтом
    const оbjectsFilter = Array.prototype.filter.call(this.оbjects, function (item) {
      return item.breakpoint === mediaBreakpoint;
    });
    matchMedia.addListener(function () {
      _this.mediaHandler(matchMedia, оbjectsFilter);
    });
    this.mediaHandler(matchMedia, оbjectsFilter);
  }
};

DynamicAdapt.prototype.mediaHandler = function (matchMedia, оbjects) {
  if (matchMedia.matches) {
    for (let i = 0; i < оbjects.length; i++) {
      const оbject = оbjects[i];
      оbject.index = this.indexInParent(оbject.parent, оbject.element);
      this.moveTo(оbject.place, оbject.element, оbject.destination);
    }
  } else {
    for (let i = 0; i < оbjects.length; i++) {
      const оbject = оbjects[i];
      if (оbject.element.classList.contains(this.daClassname)) {
        this.moveBack(оbject.parent, оbject.element, оbject.index);
      }
    }
  }
};

// Функция перемещения
DynamicAdapt.prototype.moveTo = function (place, element, destination) {
  element.classList.add(this.daClassname);
  if (place === "last" || place >= destination.children.length) {
    destination.insertAdjacentElement("beforeend", element);
    return;
  }
  if (place === "first") {
    destination.insertAdjacentElement("afterbegin", element);
    return;
  }
  destination.children[place].insertAdjacentElement("beforebegin", element);
};

// Функция возврата
DynamicAdapt.prototype.moveBack = function (parent, element, index) {
  element.classList.remove(this.daClassname);
  if (parent.children[index] !== undefined) {
    parent.children[index].insertAdjacentElement("beforebegin", element);
  } else {
    parent.insertAdjacentElement("beforeend", element);
  }
};

// Функция получения индекса внутри родителя
DynamicAdapt.prototype.indexInParent = function (parent, element) {
  const array = Array.prototype.slice.call(parent.children);
  return Array.prototype.indexOf.call(array, element);
};

// Функция сортировки массива по breakpoint и place
// по возрастанию для this.type = min
// по убыванию для this.type = max
DynamicAdapt.prototype.arraySort = function (arr) {
  if (this.type === "min") {
    Array.prototype.sort.call(arr, function (a, b) {
      if (a.breakpoint === b.breakpoint) {
        if (a.place === b.place) {
          return 0;
        }

        if (a.place === "first" || b.place === "last") {
          return -1;
        }

        if (a.place === "last" || b.place === "first") {
          return 1;
        }

        return a.place - b.place;
      }

      return a.breakpoint - b.breakpoint;
    });
  } else {
    Array.prototype.sort.call(arr, function (a, b) {
      if (a.breakpoint === b.breakpoint) {
        if (a.place === b.place) {
          return 0;
        }

        if (a.place === "first" || b.place === "last") {
          return 1;
        }

        if (a.place === "last" || b.place === "first") {
          return -1;
        }

        return b.place - a.place;
      }

      return b.breakpoint - a.breakpoint;
    });
    return;
  }
};

const da = new DynamicAdapt("max");
da.init();

let addressInput = document.querySelector("[name='address']");

function customSelect() {
  const hiddenSelect = document.querySelector(".hidden-select");
  const customSelect = document.querySelector(".custom-select");
  if (!customSelect) return;

  const header = customSelect.querySelector(".select-header");
  const options = customSelect.querySelectorAll(".option");
  const selectedOption = customSelect.querySelector(".selected-option");

  header.addEventListener("click", () => {
    customSelect.classList.toggle("open");
  });

  options.forEach((option) => {
    option.addEventListener("click", () => {
      options.forEach((opt) => opt.classList.remove("active"));
      option.classList.add("active");
      selectedOption.textContent = option.textContent;
      const icon = option.querySelector(".option-icon").src;
      customSelect.querySelector(".select-icon").src = icon;
      customSelect.classList.remove("open");
      hiddenSelect.value = option.dataset.value;
    });
  });

  document.addEventListener("click", (e) => {
    if (!customSelect.contains(e.target)) {
      customSelect.classList.remove("open");
    }
  });
}

function initClearScanBtn() {
  const clearButton = document.getElementById("clear-button");
  const form = document.querySelector(".scanner__form");

  if (clearButton) clearButton.addEventListener("click", () => {
    form.reset();
    addressInput.classList.remove("_error");
    const selectedOption = document.querySelector(".selected-option");
    if (selectedOption) {
      selectedOption.textContent = "SOL";
    }

    localStorage.removeItem("address");
  });
}

function initScanBtn() {
  const scanButton = document.querySelector(".scan");

  if (scanButton && !scanButton.classList.contains("scan-link")) scanButton.addEventListener("click", (e) => {
    e.preventDefault();
    addressInput.classList.remove("_error");
    const address = addressInput.value;

    if (!address) {
      addressInput.classList.add("_error");
      return;
    }

    localStorage.setItem("address", addressInput.value);
    window.location = "app.html";
  });
}

function initMenuItems() {
  document.querySelectorAll(".menu__item").forEach((item) => {
    const link = item.querySelector(".menu__link");

    link.addEventListener("click", (e) => {
      e.preventDefault();
      item.classList.toggle("_active");
    });
  });
}

function initAppPage() {
  // Loader
  const chatOverlay = document.querySelector(".chat-overlay");
  const closeButton = document.querySelector(".cancel");

  function openLoadingModal() {
    chatOverlay.classList.add("active");
    document.body.classList.add("no-scroll");
  }

  function closeLoadingModal() {
    chatOverlay.classList.remove("active");
    document.body.classList.remove("no-scroll");
  }

  closeButton.addEventListener("click", closeLoadingModal);

  chatOverlay.addEventListener("click", (e) => {
    if (e.target === chatOverlay) {
      closeLoadingModal();
    }
  });

  async function getAppData() {
    let address = localStorage.getItem("address");
    let data = {};
    openLoadingModal();

    await fetch("https://kira-ai-production.up.railway.app/token/get_info", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        "api-key": "7qVhdTgs7zBgLGgeuvGG",
      },
      body: JSON.stringify({ address }),
    })
      .then((res) => res.json())
      .then((res) => {
        data = res;
      });

    // data = {
    //   "token_data": {
    //     "indicator_data": {
    //       "high": {
    //         "count": 4,
    //         "details": [
    //           {
    //             "text": "Mintable risks found",
    //             "is_scam": true
    //           },
    //           {
    //             "text": "Freeze risks found",
    //             "is_scam": true
    //           },
    //           {
    //             "text": "A private wallet owns a significant share of the supply",
    //             "is_scam": false
    //           },
    //           {
    //             "text": "Tokens auto-freeze risks found",
    //             "is_scam": true
    //           },
    //           {
    //             "text": "Significant ownership by top 10 wallets",
    //             "is_scam": false
    //           },
    //           {
    //             "text": "Significant ownership by top 20 wallets",
    //             "is_scam": false
    //           },
    //           {
    //             "text": "Permanent control risks found",
    //             "is_scam": true
    //           },
    //           {
    //             "text": "Presence of token metadata",
    //             "is_scam": true
    //           },
    //           {
    //             "text": "High locked supply risks found",
    //             "is_scam": false
    //           },
    //           {
    //             "text": "Sufficient liquidity detected",
    //             "is_scam": true
    //           },
    //           {
    //             "text": "Very low liquidity",
    //             "is_scam": true
    //           }
    //         ]
    //       },
    //       "moderate": {
    //         "count": 1,
    //         "details": [
    //           {
    //             "text": "Token metadata are immutable",
    //             "is_scam": false
    //           },
    //           {
    //             "text": "Token operates without custom fees",
    //             "is_scam": true
    //           },
    //           {
    //             "text": "Token has recent user activity",
    //             "is_scam": true
    //           },
    //           {
    //             "text": "Unknown liquidity pools",
    //             "is_scam": true
    //           },
    //           {
    //             "text": "Low count of LP providers",
    //             "is_scam": true
    //           }
    //         ]
    //       },
    //       "low": {
    //         "count": 0,
    //         "details": [
    //           {
    //             "text": "Contract was not recently deployed",
    //             "is_scam": true
    //           }
    //         ]
    //       },
    //       "specific": {
    //         "count": 0,
    //         "details": [
    //           {
    //             "text": "Recent interaction within the last 30 days",
    //             "is_scam": true
    //           }
    //         ]
    //       }
    //     },
    //     "token_overview": {
    //       "deployer": "",
    //       "mint": "61aq585V8cR2sZBeawJFt2NPqmN7zDi1sws4KLs5xHXV",
    //       "address": "JUPyiwrYJFskUPiHa7hkeR8VUtAeFoSYbKedZNsDvCN",
    //       "type": "spl-token"
    //     },
    //     "token_name": "Jupiter",
    //     "token_symbol": "JUP",
    //     "token_img": "https://static.jup.ag/jup/icon.png",
    //     "address": "JUPyiwrYJFskUPiHa7hkeR8VUtAeFoSYbKedZNsDvCN",
    //     "score": 53,
    //     "deploy_time": "2024-01-26T08:19:27.000Z",
    //     "market_cap": 6776077456.52,
    //     "externals": {
    //       "website": "https://jup.ag",
    //       "coingecko_coin_id": "jupiter-exchange-solana",
    //       "discord_url": "https://discord.com/invite/jup",
    //       "twitter_handle": "JupiterExchange"
    //     },
    //     "liquidity_list": [
    //       {
    //         "fluxbeam": {
    //           "address": "FqJGBabPLPb52QXkaNLuiC8CtQThYuz5jwQRQ91rQB9h",
    //           "amount": 0.05,
    //           "lp_pair": "USDC"
    //         }
    //       },
    //       {
    //         "fluxbeam": {
    //           "address": "5yzbwusNAHdevWDhtdnAjVnsVGn6xbHSThtkDpFH92a6",
    //           "amount": 20.87,
    //           "lp_pair": "SOL"
    //         }
    //       },
    //       {
    //         "raydium": {
    //           "address": "7RJ5qmsgmvUKK5QtCLT9qHpQMegkiULppHRBNuWso12E",
    //           "amount": 317.3,
    //           "lp_pair": "USDC"
    //         }
    //       },
    //       {
    //         "raydium": {
    //           "address": "6Xmmp3Lij5d8rzXpgyGpBUBgVJUcCQ8ioRk4oJfatbLb",
    //           "amount": 6.21,
    //           "lp_pair": "SOL"
    //         }
    //       },
    //       {
    //         "raydium": {
    //           "address": "EYErUp5muPYEEkeaUCY22JibeZX7E9UuMcJFZkmNAN7c",
    //           "amount": 20210.97,
    //           "lp_pair": "SOL"
    //         }
    //       },
    //       {
    //         "raydium": {
    //           "address": "5Qtn7FFKmVH4Brx3V1cR8E4mot2V3eSmvFRBpmKjNy35",
    //           "amount": 1933.84,
    //           "lp_pair": "SOL"
    //         }
    //       },
    //       {
    //         "orca": {
    //           "address": "C1MgLojNLWBKADvu9BHdtgzz1oZX4dZ5zGdGcgvvW8Wz",
    //           "amount": 3429140.58,
    //           "lp_pair": "SOL"
    //         }
    //       },
    //       {
    //         "orca": {
    //           "address": "4Ui9QdDNuUaAGqCPcDSp191QrixLzQiLxJ1Gnqvz3szP",
    //           "amount": 643930.21,
    //           "lp_pair": "USDC"
    //         }
    //       },
    //       {
    //         "orca": {
    //           "address": "HrLmpzp8Nu5wkn9SGZYSS9Ms6deTvMgGc6BETp4161ZX",
    //           "amount": 129537.2,
    //           "lp_pair": "USDC"
    //         }
    //       },
    //       {
    //         "orca": {
    //           "address": "DkVN7RKTNjSSER5oyurf3vddQU2ZneSCYwXvpErvTCFA",
    //           "amount": 18837.02,
    //           "lp_pair": "SOL"
    //         }
    //       },
    //       {
    //         "orca": {
    //           "address": "EgcgMpmGnGvU3Wa8T6gvmEN6pfSXXSxPTbYNEHVh8cZk",
    //           "amount": 47749.12,
    //           "lp_pair": "SOL"
    //         }
    //       },
    //       {
    //         "orca": {
    //           "address": "FYmLrqgfrZ6u1Qvfo48wnhGp4HxXeQP7SQB5USQyQCPQ",
    //           "amount": 55192.75,
    //           "lp_pair": "USDC"
    //         }
    //       },
    //       {
    //         "orca": {
    //           "address": "FgTCR1ufcaTZMwZZYhNRhJm2K3HgMA8V8kXtdqyttm19",
    //           "amount": 168927.89,
    //           "lp_pair": "SOL"
    //         }
    //       },
    //       {
    //         "orca": {
    //           "address": "EzCFMMo43qLLkYQqhLG8Kjj4UL3Dwvk2paf7yqB575KP",
    //           "amount": 19086.78,
    //           "lp_pair": "SOL"
    //         }
    //       },
    //       {
    //         "orca": {
    //           "address": "GaRZqVJCpRMsM12ZTaP13zpaY6npHw2SeruZRWY2GGfn",
    //           "amount": 1712.33,
    //           "lp_pair": "USDC"
    //         }
    //       },
    //       {
    //         "orca": {
    //           "address": "48ZRFBUm6cu4Cq1wYsKPdGjJm8tuPtNumiFNKGfSMPoE",
    //           "amount": 656.95,
    //           "lp_pair": "USDC"
    //         }
    //       },
    //       {
    //         "orca": {
    //           "address": "DKVSTt1CuCYGk1uPiFVwMRcQkR6zUVqTX82qgvxsPGPt",
    //           "amount": 1058.71,
    //           "lp_pair": "SOL"
    //         }
    //       },
    //       {
    //         "orca": {
    //           "address": "85sChDdMcqeJhR7UsBf9jqk3guproVzWrqkf9dn1yYn5",
    //           "amount": 2166.08,
    //           "lp_pair": "USDC"
    //         }
    //       },
    //       {
    //         "orca": {
    //           "address": "2rK8mS671NSfUrmstdGRQ6R1vh4hcbDJVFGNrTKGytqb",
    //           "amount": 4.31,
    //           "lp_pair": "SOL"
    //         }
    //       },
    //       {
    //         "meteora": {
    //           "address": "Ft1cHxNviZQPwR3MkVRrXE8boRyR55Nbe5nuTfQ1QXEn",
    //           "amount": 2717.78,
    //           "lp_pair": "USDC"
    //         }
    //       },
    //       {
    //         "meteora": {
    //           "address": "8ruDME2JQX19m8wX6DHxhYA5qg5davvNpYmBJDCDo6i5",
    //           "amount": 42.52,
    //           "lp_pair": "SOL"
    //         }
    //       },
    //       {
    //         "meteora": {
    //           "address": "4TuDBxJUofDqo6EbcByESnFzMfsuCQKMkoogYXRX4G4c",
    //           "amount": 104.77,
    //           "lp_pair": "USDC"
    //         }
    //       },
    //       {
    //         "meteora": {
    //           "address": "E1nhUcSbuZrg3pcRdM6CeSXD9GJNpWqWYSkLvuip1CFm",
    //           "amount": 25790.7,
    //           "lp_pair": "USDC"
    //         }
    //       },
    //       {
    //         "meteora": {
    //           "address": "2bgMd1TDJRvn9rw1fFsMHoERnmHemwfEA1FCikTpuWaJ",
    //           "amount": 344.45,
    //           "lp_pair": "SOL"
    //         }
    //       },
    //       {
    //         "meteora": {
    //           "address": "FzzuhatP1MJ2G1NHKCetGu4BgtwDVaZNLcCNPf5WobHr",
    //           "amount": 85.33,
    //           "lp_pair": "SOL"
    //         }
    //       },
    //       {
    //         "meteora": {
    //           "address": "BfUdkmni3KoeLxrD83BzZAC2kA5JspkeHQ2UjovkcByp",
    //           "amount": 156.52,
    //           "lp_pair": "USDC"
    //         }
    //       },
    //       {
    //         "meteora": {
    //           "address": "GHs1yYvQ8QeVM4AvqYo1azeM7xatednMWANdrkdRZQ6P",
    //           "amount": 91.52,
    //           "lp_pair": "SOL"
    //         }
    //       },
    //       {
    //         "meteora": {
    //           "address": "5c1muthW8MBWhGmavLtqyyN7va59veQtvmdxQB4T41pJ",
    //           "amount": 39.97,
    //           "lp_pair": "SOL"
    //         }
    //       },
    //       {
    //         "meteora": {
    //           "address": "Cidms1NTWB1k2HfVew8QUtxNQ23HzQ8bBSMUvUjQyhKk",
    //           "amount": 1.95,
    //           "lp_pair": "SOL"
    //         }
    //       },
    //       {
    //         "meteora": {
    //           "address": "3y3bZzEbxuKpfmqLr8S3jMuggQg1nU3ZXJ1TfJTWgz38",
    //           "amount": 0.03,
    //           "lp_pair": "USDC"
    //         }
    //       },
    //       {
    //         "meteora": {
    //           "address": "9s3fDDKr4mMAxgboddzJh7dshMkSCNELx1KnGMcNsC6F",
    //           "amount": 0.01,
    //           "lp_pair": "SOL"
    //         }
    //       },
    //       {
    //         "meteora": {
    //           "address": "hPkPt9Mvu3f6Bpky38ekfqRb37DSFnHtdjnFpfF86wY",
    //           "amount": 184058.52,
    //           "lp_pair": "SOL"
    //         }
    //       }
    //     ],
    //     "total_liquidity": 4753923.239999998,
    //     "owners_list": [
    //       {
    //         "address": "61aq585V8cR2sZBeawJFt2NPqmN7zDi1sws4KLs5xHXV",
    //         "amount": 2149366668.17,
    //         "percentage": "30.71"
    //       },
    //       {
    //         "address": "EXJHiMkj6NRFDfhWBMKccHNwdSpCT7tdvQeRf87yHm6T",
    //         "amount": 1700000000.0,
    //         "percentage": "24.29"
    //       },
    //       {
    //         "address": "Any5gL74oUQy9Psb3goym9STaYMau4CMrTkryS37T7iz",
    //         "amount": 429344964.5,
    //         "percentage": "6.13"
    //       },
    //       {
    //         "address": "FVhQ3QHvXudWSdGix2sdcG47YmrmUxRhf3KCBmiKfekf",
    //         "amount": 357349634.37,
    //         "percentage": "5.11"
    //       },
    //       {
    //         "address": "9WzDXwBbmkg8ZTbNMqUxvQRAyrZzDsGYdLVL9zYtAWWM",
    //         "amount": 188743162.3,
    //         "percentage": "2.70"
    //       },
    //       {
    //         "address": "CbU4oSFCk8SVgW23NLvb5BwctvWcZZHfxRD6HudP8gAo",
    //         "amount": 126376933.04,
    //         "percentage": "1.81"
    //       },
    //       {
    //         "address": "CPZmKkAhD2wv1Z21EUZvdH8ZeSD13geAnSfyVBwcW8XK",
    //         "amount": 104479516.85,
    //         "percentage": "1.49"
    //       },
    //       {
    //         "address": "6wsjaQTidXNqmPDw4st2yMtFmTk7yyBEox5SydFQeJe7",
    //         "amount": 94414766.37,
    //         "percentage": "1.35"
    //       },
    //       {
    //         "address": "27b4PRN7K37rpTywq65t29rjuNfQkYpxZUjkbtHc5VvZ",
    //         "amount": 59002761.66,
    //         "percentage": "0.84"
    //       },
    //       {
    //         "address": "5tzFkiKscXHK5ZXCGbXZxdw7gTjjD1mBwuoFbhUvuAi9",
    //         "amount": 52674095.68,
    //         "percentage": "0.75"
    //       },
    //       {
    //         "address": "9un5wqE3q4oCjyrDkwsdD48KteCJitQX5978Vh7KKxHo",
    //         "amount": 33286702.27,
    //         "percentage": "0.48"
    //       },
    //       {
    //         "address": "52NdYBSkCgUUpsYximNir6Vv57Wp7bDJhtBvD26Goc7S",
    //         "amount": 33089239.45,
    //         "percentage": "0.47"
    //       },
    //       {
    //         "address": "8UfoUq3mWe8NbKpQvbv5LXuJ42EDLpjHZezTk4mYgs6f",
    //         "amount": 31471611.72,
    //         "percentage": "0.45"
    //       },
    //       {
    //         "address": "CU23oSHFsdKAd9XhM1hDPLvza32ZDt5Q8RHGUQqRxbqC",
    //         "amount": 31471589.28,
    //         "percentage": "0.45"
    //       },
    //       {
    //         "address": "HZVW75BkNM6JyFerRgrtkpAzDSoZj6Z8HSaf9RPWvydy",
    //         "amount": 31471588.87,
    //         "percentage": "0.45"
    //       },
    //       {
    //         "address": "5JA6jjjTKSEMDUKRcNgVmVtn7QcpWWkL7svTNVjgksEq",
    //         "amount": 31471588.87,
    //         "percentage": "0.45"
    //       },
    //       {
    //         "address": "42brAgAVNzMBP7aaktPvAmBSPEkehnFQejiZc53EpJFd",
    //         "amount": 30000002.0,
    //         "percentage": "0.43"
    //       },
    //       {
    //         "address": "65EzZ3nWtYdXaF4j38R9jW795EFsrxXkheNfxu5XdCVJ",
    //         "amount": 23603691.6,
    //         "percentage": "0.34"
    //       },
    //       {
    //         "address": "8Mm46CsqxiyAputDUp2cXHg41HE3BfynTeMBDwzrMZQH",
    //         "amount": 20707749.62,
    //         "percentage": "0.30"
    //       },
    //       {
    //         "address": "9cNE6KBg2Xmf34FPMMvzDF8yUHMrgLRzBV3vD7b1JnUS",
    //         "amount": 15871870.66,
    //         "percentage": "0.23"
    //       },
    //       {
    //         "address": "AC5RDfQFmDS1deWZos921JfqscXdByf8BKHs5ACWjtW2",
    //         "amount": 15618187.71,
    //         "percentage": "0.22"
    //       },
    //       {
    //         "address": "2sAU9KAbwYnr1TbbMNSfjeFAbbJHqrwBu9TNCKHvauHQ",
    //         "amount": 13770537.46,
    //         "percentage": "0.20"
    //       },
    //       {
    //         "address": "7dXvWy5SiyEjU9FZkWbCivSX2Ln4yU4s457WFSuS4tCH",
    //         "amount": 12918758.04,
    //         "percentage": "0.18"
    //       },
    //       {
    //         "address": "ErKMcavNSxDg79zK6oybGY6p68k7P99JHgcUSVU3cmTw",
    //         "amount": 12818491.39,
    //         "percentage": "0.18"
    //       },
    //       {
    //         "address": "3ni7eujip6vuaGJEqtLRpZgX8orcs4qSqr58WYPMyRGZ",
    //         "amount": 11382182.67,
    //         "percentage": "0.16"
    //       },
    //       {
    //         "address": "DitTCos4ixB9yprJYgAP7hYpWcEVutyRz4NdzkEvr18P",
    //         "amount": 10490529.7,
    //         "percentage": "0.15"
    //       },
    //       {
    //         "address": "dQCPKUFLCd8kKFNDYPX3Yt5hBwxA6LokF5cZTAdhU9B",
    //         "amount": 10490529.7,
    //         "percentage": "0.15"
    //       },
    //       {
    //         "address": "2BCehXF5MzvhWbCEA7KMTT9pvir1AE9ngwv3sLseR4uP",
    //         "amount": 10490529.7,
    //         "percentage": "0.15"
    //       },
    //       {
    //         "address": "FWznbcNXWQuHTawe9RxvQ2LdCENssh12dsznf4RiouN5",
    //         "amount": 9845074.14,
    //         "percentage": "0.14"
    //       },
    //       {
    //         "address": "FiJNwTdcZmaC4CcPrGU1M1QGxeaGptJSGcMuYMeKEwri",
    //         "amount": 9581477.28,
    //         "percentage": "0.14"
    //       },
    //       {
    //         "address": "HgvEbgL3pqELcnTdJn9wdPp9wiRsCJwMRvKmwWC5Si4m",
    //         "amount": 9099540.85,
    //         "percentage": "0.13"
    //       },
    //       {
    //         "address": "5sTQ5ih7xtctBhMXHr3f1aWdaXazWrWfoehqWdqWnTFP",
    //         "amount": 8933006.97,
    //         "percentage": "0.13"
    //       },
    //       {
    //         "address": "4GC3a1RkRXx5shwGP8pTY6cxXgSWkbfc66vM53a6qSKj",
    //         "amount": 8514111.91,
    //         "percentage": "0.12"
    //       },
    //       {
    //         "address": "G7vJSWXL4rFQdvvWEEdNDYUkiWYnp59XTDvK58GjyUi1",
    //         "amount": 8162723.11,
    //         "percentage": "0.12"
    //       },
    //       {
    //         "address": "SDu69pvwZMPRdPPhMkt6twnotWCERLwU8LuvYwL73vp",
    //         "amount": 7867897.23,
    //         "percentage": "0.11"
    //       },
    //       {
    //         "address": "Fm7KRdRLJJVNaB5YkcZf3YYmciMwbQ1xmJC9nNS7Rej6",
    //         "amount": 7867897.23,
    //         "percentage": "0.11"
    //       },
    //       {
    //         "address": "B5sTcNpS2zsemMpgNyUsqSDJVrMXvDQeiX7X19WAwvtB",
    //         "amount": 7784106.3,
    //         "percentage": "0.11"
    //       },
    //       {
    //         "address": "u6PJ8DtQuPFnfmwHbGFULQ4u4EgjDiyYKjVEsynXq2w",
    //         "amount": 7517037.89,
    //         "percentage": "0.11"
    //       },
    //       {
    //         "address": "22Wnk8PwyWZV7BfkZGJEKT9jGGdtvu7xY6EXeRh7zkBa",
    //         "amount": 7221848.76,
    //         "percentage": "0.10"
    //       },
    //       {
    //         "address": "26nbFGWaybNdMoPKgG5eNznkrAjFR4dgXSCsbF2Xkt5j",
    //         "amount": 7070889.97,
    //         "percentage": "0.10"
    //       },
    //       {
    //         "address": "9un5wqE3q4oCjyrDkwsdD48KteCJitQX5978Vh7KKxHo",
    //         "amount": 33286702.27,
    //         "percentage": "0.48"
    //       },
    //       {
    //         "address": "52NdYBSkCgUUpsYximNir6Vv57Wp7bDJhtBvD26Goc7S",
    //         "amount": 33089239.45,
    //         "percentage": "0.47"
    //       },
    //       {
    //         "address": "8UfoUq3mWe8NbKpQvbv5LXuJ42EDLpjHZezTk4mYgs6f",
    //         "amount": 31471611.72,
    //         "percentage": "0.45"
    //       },
    //       {
    //         "address": "CU23oSHFsdKAd9XhM1hDPLvza32ZDt5Q8RHGUQqRxbqC",
    //         "amount": 31471589.28,
    //         "percentage": "0.45"
    //       },
    //       {
    //         "address": "HZVW75BkNM6JyFerRgrtkpAzDSoZj6Z8HSaf9RPWvydy",
    //         "amount": 31471588.87,
    //         "percentage": "0.45"
    //       },
    //       {
    //         "address": "5JA6jjjTKSEMDUKRcNgVmVtn7QcpWWkL7svTNVjgksEq",
    //         "amount": 31471588.87,
    //         "percentage": "0.45"
    //       },
    //       {
    //         "address": "42brAgAVNzMBP7aaktPvAmBSPEkehnFQejiZc53EpJFd",
    //         "amount": 30000002.0,
    //         "percentage": "0.43"
    //       },
    //       {
    //         "address": "65EzZ3nWtYdXaF4j38R9jW795EFsrxXkheNfxu5XdCVJ",
    //         "amount": 23603691.6,
    //         "percentage": "0.34"
    //       },
    //       {
    //         "address": "8Mm46CsqxiyAputDUp2cXHg41HE3BfynTeMBDwzrMZQH",
    //         "amount": 20707749.62,
    //         "percentage": "0.30"
    //       },
    //       {
    //         "address": "9cNE6KBg2Xmf34FPMMvzDF8yUHMrgLRzBV3vD7b1JnUS",
    //         "amount": 15871870.66,
    //         "percentage": "0.23"
    //       }
    //     ],
    //     "audit_risk": {
    //       "mint_disabled": true,
    //       "freeze_disabled": true,
    //       "lp_burned": false,
    //       "top10holders": false
    //     }
    //   },
    //   "token_info": {
    //     "price": 0.872476,
    //     "supply_amount": 6999978765.175975,
    //     "mkt_cap": 6107313473.125674
    //   },
    //   "explorer_link": "https://solscan.io/token/JUPyiwrYJFskUPiHa7hkeR8VUtAeFoSYbKedZNsDvCN",
    //   "is_risk": true
    // }

    closeLoadingModal();

    return data;
  }

  // Data Preview
  function getElBySelector(selector) {
    return document.querySelector(selector);
  }

  function setHtmlContent(selector, html) {
    const el = getElBySelector(selector);

    if (!el) console.log('selector', selector);
    el.innerHTML = html;
  }

  function setDataCopy(selector, value) {
    const el = getElBySelector(selector);

    if (!el) console.log('selector', selector);
    el.setAttribute("data-copy", value);
  }

  const setDataPreview = async () => {
    const data = await getAppData();
    // Set Project info
    const logo = getElBySelector(".project__info img");
    if (logo) logo.src = data.token_data.token_img;

    setHtmlContent(".project__info .name", data.token_data.token_name);
    setHtmlContent(".project__info .subname", data.token_data.token_symbol);
    setHtmlContent(".ca span", data.token_data.address);
    setHtmlContent(".supply span", data.token_info.supply_amount);
    setDataCopy(".link-1", data.token_data.externals.website);
    setDataCopy(".link-3", data.explorer_link);

    setHtmlContent(".market-cap", "$ " + data.token_data.market_cap);
    setHtmlContent(".token-price", "$ " + data.token_info.price);
    setHtmlContent(".tax-value", "-");

    // Set Liquidity
    const openLiquidity = getElBySelector(".open__liquidity");
    const lockLiquidity = getElBySelector(".lock__liquidity");
    const total_liquidity = data.token_data.total_liquidity;
    if (total_liquidity) {
      openLiquidity.classList.remove("none");
      lockLiquidity.classList.add("none");
      setHtmlContent(".liquidity__dollar", total_liquidity);
    } else {
      openLiquidity.classList.add("none");
      lockLiquidity.classList.remove("none");
    }

    const passed = getElBySelector(".passed");
    if (data.is_risk) {
      passed.classList.remove("none");
      passed.textContent = data.is_risk ? "HONEYPOT" : "PASSED";
    }

    // Set Tabs data

    // Tab Scan
    const levels = ["high", "moderate", "low", "specific"];
    const buttonsHtml = levels
      .map((level) => {
        const count = data.token_data.indicator_data[level].count;
        const color =
          level === "high" ? "#ff0000" : level === "moderate" ? "#ffa500" : level === "low" ? "#90a500" : "#008000";
        return generateBurnBtnHtml(level.charAt(0).toUpperCase() + level.slice(1), color, count);
      })
      .join("");
    setHtmlContent(".tabs__left_buttons", buttonsHtml);
    setBurnItems();
    addFilterInBurnBtns();
    setTabsHeight();

    // Tab Tools
    setHtmlContent(".deploy-time", new Date(data.token_data.deploy_time).toDateString());

    // Tab Top Holders
    const ownersList = data.token_data.owners_list;
    const table = document.querySelector(".table");
    const rowsWrap = document.querySelector(".table__rows");
    const rows = table.querySelectorAll(".table__row");
    rows.forEach((row) => row.remove());

    ownersList.forEach((owner) => {
      const row = document.createElement("div");
      row.className = "table__row";

      row.innerHTML = `
      <div class="col-3" data-copy>
        ${owner.address}
      </div>
      <div class="col-3">
        ${owner.amount}
      </div>
      <div class="col-3">
        ${owner.percentage}
      </div>
    `;

      rowsWrap.appendChild(row);
    });

    function setBurnItems() {
      const burnContainer = getElBySelector(".tabs__burn");
      const rightContainer = getElBySelector(".tabs__right");

      const burnHtml = [];
      const rightHtml = [];

      let count = 0;

      levels.forEach((level) => {
        const details = data.token_data.indicator_data[level].details;
        details.forEach((detail, index) => {
          const itemHtml = generateBurnItemHtml(detail.text, detail.is_scam, level);
          if (count < 4) {
            burnHtml.push(itemHtml);
          } else {
            rightHtml.push(itemHtml);
          }
          count++;
        });
      });

      burnContainer.innerHTML = burnHtml.join("");
      rightContainer.innerHTML = rightHtml.join("");
    }

    function generateBurnItemHtml(text, isScam, type) {
      return `
      <div class="tabs__left_burn" data-burn-type="${type}">
        <p class="burn__text">${text}</p>
        <div class="${isScam ? "yes" : "no"}">
          ${isScam ? "YES" : "NO"}
        </div>
      </div>
    `;
    }

    function generateBurnBtnHtml(text, color, count) {
      return `
      <div class="tabs__left_button tabs-filter-btn" data-filter-btn="${text.toLowerCase()}">
        <span class="circle" style="background-color: ${color};"></span> ${text} (${count})
      </div>
    `;
    }

    function addFilterInBurnBtns() {
      const btns = document.querySelectorAll("[data-filter-btn]");
      const items = document.querySelectorAll("[data-burn-type]");

      btns.forEach((btn) => {
        btn.addEventListener("click", () => {
          btns.forEach((e) => e.classList.remove("_active"));
          btn.classList.add("_active");
          const btnType = btn.getAttribute("data-filter-btn");

          items.forEach((item) => {
            item.classList.remove("none");

            const itemType = item.getAttribute("data-burn-type");
            if (itemType !== btnType) {
              item.classList.add("none");
            }
          });
        });
      });
    }

    function setTabsHeight() {
      const tabLefts = document.querySelectorAll(".tabs__left");
      const tabRights = document.querySelectorAll(".tabs__right");
      tabLefts.forEach((tabLeft, index) => {
        const tabRight = tabRights[index];
        if (tabRight) tabRight.style.maxHeight = tabLeft.clientHeight + "px";
      });
    }

    initCopied();
  };

  setDataPreview();

  function setDefaultDataPreview() {
    const logo = getElBySelector(".project__info img");
    if (logo) logo.src = "./image/app/icon.svg";

    setHtmlContent(".project__info .name", "Name");
    setHtmlContent(".project__info .subname", "Name");
    setHtmlContent(".ca span", "CA:000000000000");
    setHtmlContent(".supply span", "1B");
    setDataCopy(".link-1", "#");
    setDataCopy(".link-3", "#");

    setHtmlContent(".market-cap", "$ " + "0 000 000");
    setHtmlContent(".token-price", "$ " + "0,000000");
    setHtmlContent(".tabs__left_buttons", "");
    setHtmlContent(".tabs__right", "");
    setHtmlContent(".tabs__burn", "");
    setHtmlContent(".liquidity__dollar", "");

    setHtmlContent(".tabs__full_1", "");
    setHtmlContent(".tabs__full_2", "");
    setHtmlContent(".tax-value", "-");

    // Set Liquidity
    const openLiquidity = getElBySelector(".open__liquidity");
    const lockLiquidity = getElBySelector(".lock__liquidity");

    openLiquidity.classList.add("none");
    lockLiquidity.classList.remove("none");

    const passed = getElBySelector(".passed");
    if (data.is_risk) {
      passed.classList.add("none");
    }
  }

  const refreshBtn = document.querySelector(".refresh");
  refreshBtn.addEventListener("click", setDefaultDataPreview);
}

document.addEventListener("DOMContentLoaded", () => {
  // Scan Form
  addressInput = document.querySelector("[name='address']");
  customSelect();
  initClearScanBtn();
  initScanBtn();

  // Menu Items
  initMenuItems();

  // App Page
  if (window.location.pathname === "/app/app.html") initAppPage();
});
